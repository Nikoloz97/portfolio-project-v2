import {
  pointsArray,
  threePointsMadeArray,
  rebArray,
  astArray,
  stlArray,
  blkArray,
  fgArray,
  ftArray,
  turnoversArray,
} from "./TopPlayerStats";

export const selectedPlayersArray = [
  {
    playerName: "Player 1",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 2",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 3",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 4",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 5",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 6",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 7",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 8",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 9",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 10",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 11",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
  {
    playerName: "Player 12",
    teamName: "",
    playerURL: "",
    isPlayerChosen: false,
    stats: [
      {
        name: "Points",
        value: 0,
      },
      {
        name: "Field Goal %",
        value: 0,
      },
      {
        name: "Free Throw %",
        value: 0,
      },
      {
        name: "3 Point Makes",
        value: 0,
      },
      {
        name: "Rebounds",
        value: 0,
      },
      {
        name: "Blocks",
        value: 0,
      },
      {
        name: "Turnovers",
        value: 0,
      },
      {
        name: "Assists",
        value: 0,
      },
      {
        name: "Steals",
        value: 0,
      },
    ],
  },
];

export const populateCurrentPlayer = (
  updatedSelectedPlayers,
  currentPlayer,
  fetchedData,
  playerIndex,
  setSelectedPlayers
) => {
  currentPlayer.playerName = fetchedData.espnName;

  currentPlayer.teamName = fetchedData.team;

  currentPlayer.playerURL = fetchedData.espnHeadshot;

  currentPlayer.isPlayerChosen = true;

  currentPlayer.stats[0].value = fetchedData.stats.pts;

  currentPlayer.stats[1].value = fetchedData.stats.fgp / 100;

  currentPlayer.stats[2].value = fetchedData.stats.ftp / 100;

  currentPlayer.stats[3].value = fetchedData.stats.tptfgm;

  currentPlayer.stats[4].value = fetchedData.stats.reb;

  currentPlayer.stats[5].value = fetchedData.stats.blk;

  currentPlayer.stats[6].value = fetchedData.stats.TOV;

  currentPlayer.stats[7].value = fetchedData.stats.ast;

  currentPlayer.stats[8].value = fetchedData.stats.stl;

  updatedSelectedPlayers[playerIndex] = currentPlayer;

  setSelectedPlayers(updatedSelectedPlayers);
};

const calculateCategoryAverage = (playerCollection, statIndex) => {
  return (
    playerCollection.reduce(
      (acc, player) => acc + parseFloat(player.stats[statIndex].value),
      0
    ) / 12
  ).toFixed(2);
};

export const populateAverageUserCategories = (playerCollection) => {
  return [
    {
      category: "PTS",
      value: calculateCategoryAverage(playerCollection, 0),
    },
    {
      category: "FG%",
      value: calculateCategoryAverage(playerCollection, 1),
    },
    {
      category: "FT%",
      value: calculateCategoryAverage(playerCollection, 2),
    },
    {
      category: "3PM",
      value: calculateCategoryAverage(playerCollection, 3),
    },
    {
      category: "REB",
      value: calculateCategoryAverage(playerCollection, 4),
    },
    {
      category: "BLK",
      value: calculateCategoryAverage(playerCollection, 5),
    },
    {
      category: "TO",
      value: calculateCategoryAverage(playerCollection, 6),
    },
    {
      category: "AST",
      value: calculateCategoryAverage(playerCollection, 7),
    },
    {
      category: "STL",
      value: calculateCategoryAverage(playerCollection, 8),
    },
  ];
};

export const populateTop150Cats = () => {
  return [
    {
      category: "PTS",
      value: 17.05,
    },
    {
      category: "FG%",
      value: 49.36,
    },
    {
      category: "FT%",
      value: 79.43,
    },
    {
      category: "3PM",
      value: 1.74,
    },
    {
      category: "REB",
      value: 5.83,
    },
    {
      category: "BLK",
      value: 0.71,
    },
    {
      category: "TO",
      value: 1.88,
    },
    {
      category: "AST",
      value: 3.97,
    },
    {
      category: "STL",
      value: 0.97,
    },
  ];
};

// Percentiles...

let percentiles = [
  {
    category: "PTS",
    percentile: 0,
  },
  {
    category: "FG%",
    percentile: 0,
  },
  {
    category: "FT%",
    percentile: 0,
  },
  {
    category: "3PM",
    percentile: 0,
  },
  {
    category: "REB",
    percentile: 0,
  },
  {
    category: "BLK",
    percentile: 0,
  },
  {
    category: "TO",
    percentile: 0,
  },
  {
    category: "AST",
    percentile: 0,
  },
  {
    category: "STL",
    percentile: 0,
  },
];

const handlePercentileCalculation = (array, userCategoryValue) => {
  // Binary search
  let startIndex = 0;
  let endIndex = array.length - 1;
  while (startIndex <= endIndex) {
    let midIndex = Math.floor((startIndex + endIndex) / 2);
    // Checks for absolute min and max
    if (midIndex === 0) {
      return 0;
    } else if (midIndex === array.length - 1) {
      return array.length - 1;
    }
    // Sorting is in ascending order
    else if (
      userCategoryValue === array[midIndex] ||
      (userCategoryValue > array[midIndex - 1] &&
        userCategoryValue < array[midIndex + 1])
    ) {
      return midIndex;
    } else if (userCategoryValue > array[midIndex]) {
      startIndex = midIndex + 1;
    } else if (userCategoryValue < array[midIndex]) {
      endIndex = midIndex - 1;
    }
  }
};

export const populatePercentiles = (userCats) => {
  // TODO: create a webhook that takes data and returns in sorted order
  let sortedPointsArray = pointsArray.sort((a, b) => a - b);
  let sortedFgArray = fgArray.sort((a, b) => a - b);
  let sortedFtArray = ftArray.sort((a, b) => a - b);
  let sortedThreePointsArray = threePointsMadeArray.sort((a, b) => a - b);
  let sortedReboundsArray = rebArray.sort((a, b) => a - b);
  let sortedBlocksArray = blkArray.sort((a, b) => a - b);
  let sortedTurnoverArray = turnoversArray.sort((a, b) => a - b);
  let sortedAssistsArray = astArray.sort((a, b) => a - b);
  let sortedStealsArray = stlArray.sort((a, b) => a - b);

  percentiles.forEach((percObj) => {
    switch (percObj.category) {
      case "PTS":
        const pointsPercentile = handlePercentileCalculation(
          sortedPointsArray,
          userCats[0].value
        );
        percObj.percentile = pointsPercentile;
        break;
      case "FG%":
        const fgPercentile = handlePercentileCalculation(
          sortedFgArray,
          userCats[1].value
        );
        percObj.percentile = fgPercentile;
        break;
      case "FT%":
        const ftPercentile = handlePercentileCalculation(
          sortedFtArray,
          userCats[2].value
        );
        percObj.percentile = ftPercentile;
        break;
      case "3PM":
        const threePointsPercentile = handlePercentileCalculation(
          sortedThreePointsArray,
          userCats[3].value
        );
        percObj.percentile = threePointsPercentile;
        break;
      case "REB":
        const reboundsPercentile = handlePercentileCalculation(
          sortedReboundsArray,
          userCats[4].value
        );
        percObj.percentile = reboundsPercentile;
        break;
      case "BLK":
        const blocksPercentile = handlePercentileCalculation(
          sortedBlocksArray,
          userCats[5].value
        );
        percObj.percentile = blocksPercentile;
        break;
      case "TO":
        const turnoverPercentile = handlePercentileCalculation(
          sortedTurnoverArray,
          userCats[6].value
        );
        // Turnovers = exception (lower = better)
        percObj.percentile = sortedTurnoverArray.length - turnoverPercentile;
        break;
      case "AST":
        const assistsPercentile = handlePercentileCalculation(
          sortedAssistsArray,
          userCats[7].value
        );
        percObj.percentile = assistsPercentile;
        break;
      case "STL":
        const stealsPercentile = handlePercentileCalculation(
          sortedStealsArray,
          userCats[8].value
        );
        percObj.percentile = stealsPercentile;
        break;
    }
  });

  return percentiles;
};
